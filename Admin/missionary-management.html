<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„ êµì‚¬ ê´€ë¦¬</title>
    <link rel="stylesheet" href="css/common/base.css">
    <link rel="stylesheet" href="css/common/navigation.css">
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="css/missionary-management.css">
    <style>
        /* ë¡œê·¸ì¸ì´ í™•ì¸ë˜ê¸° ì „ê¹Œì§€ í˜ì´ì§€ ë‚´ìš©ì„ ìˆ¨ê¹ë‹ˆë‹¤. */
        body { display: none; }
        
        .count-badge {
            background: #007bff;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: 1rem;
            font-size: 0.9rem;
            color: #666;
        }
        
        .checkbox-label input[type="checkbox"] {
            margin: 0;
        }
        
        .search-section {
            display: flex;
            align-items: center;
        }
        
        .loading-placeholder {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body data-page="missionary-management">
    <div id="nav-container"></div>

    <main class="admin-main">
        <h1>ğŸ‘¥ ì„ êµì‚¬ ê´€ë¦¬ <span class="count-badge" id="missionaryCount">0</span></h1>
        <!-- ìš”ì•½/ì•ˆë‚´ ë°•ìŠ¤ -->
        <div class="summary-box">
          <button class="btn btn-primary" id="btn-all-email">ì „ì²´ì´ë©”ì¼</button>
          <button class="btn btn-primary" id="btn-inactive-email">ëœ¸í•œë¶„ë©”ì¼</button>
          <button class="btn btn-primary" id="btn-export-local-info">í˜„ì§€ì •ë³´ì¶œë ¥</button>
          <button class="btn btn-secondary" id="btn-certificate-send">íŒŒì†¡ì¦ëª…ì„œ</button>
          <button class="btn btn-secondary" id="btn-certificate-employ">ì¬ì§ì¦ëª…ì„œ</button>
          <button class="btn btn-secondary" id="btn-certificate-career">ê²½ë ¥ì¦ëª…ì„œ</button>
        </div>
        <div class="action-bar">
            <div class="search-section">
                <input type="text" id="missionarySearch" placeholder="ì´ë¦„ ë˜ëŠ” êµ­ê°€ë¡œ ê²€ìƒ‰..." class="search-input">
                <label class="checkbox-label">
                    <input type="checkbox" id="includeArchived">
                    ì•„ì¹´ì´ë¸Œ í¬í•¨
                </label>
            </div>
            <div class="action-buttons">
                <button type="button" class="btn btn-primary" id="addMissionaryBtn">
                    â• ì„ êµì‚¬ ì¶”ê°€
                </button>
            </div>
        </div>

        <div class="missionary-list-container">
            <div id="missionaryList" class="missionary-list">
                <!-- ê¸°ì¡´ missionaryList ë‚´ìš©ì€ missionaryManagement.jsì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤. -->
                <div class="loading-placeholder">
                    <div class="loading-spinner"></div>
                    <p>ì„ êµì‚¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            </div>
        </div>
    </main>

    <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
    <div id="loginModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
                <button type="button" class="close-btn" onclick="closeLoginModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form onsubmit="event.preventDefault(); performLogin();">
                    <div class="form-group">
                        <label for="loginEmail">ì´ë©”ì¼:</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">ë¹„ë°€ë²ˆí˜¸:</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <div id="loginStatus" class="login-status"></div>
                    <button type="submit" class="btn btn-primary">ë¡œê·¸ì¸</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- ì„ êµì‚¬ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
    <div id="missionaryDetailModal" class="modal" style="display: none;">
      <div class="modal-content large-modal">
        <div class="modal-header">
          <h2>ğŸ‘¤ ì„ êµì‚¬ ìƒì„¸ì •ë³´</h2>
          <button type="button" class="close-btn" onclick="closeMissionaryDetailModal()">&times;</button>
        </div>
        <div class="modal-body" id="missionaryDetailContent">
          <!-- ìƒì„¸ì •ë³´ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="editMissionaryBtn">âœï¸ ìˆ˜ì •</button>
          <button type="button" class="btn btn-secondary" onclick="closeMissionaryDetailModal()">ë‹«ê¸°</button>
        </div>
      </div>
    </div>

    <!-- ì„ êµì‚¬ ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="editMissionaryModal" class="modal" style="display: none;">
      <div class="modal-content large-modal">
        <div class="modal-header">
          <h2>âœï¸ ì„ êµì‚¬ ìˆ˜ì •</h2>
          <button type="button" class="close-btn" onclick="closeEditMissionaryModal()">&times;</button>
        </div>
        <div class="modal-body" id="editMissionaryContent">
          <!-- ìˆ˜ì • í¼ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
        </div>
      </div>
    </div>

    <!-- ì „ì²´ì´ë©”ì¼ ëª¨ë‹¬ -->
    <div id="modal-all-email" class="modal" style="display:none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ì „ì²´ ì´ë©”ì¼ ë°œì†¡</h2>
          <button type="button" class="close-btn" onclick="closeModal('modal-all-email')">&times;</button>
        </div>
        <div class="modal-body" id="modal-all-email-body">
          <div class="form-group">
            <label><b>ì´ë©”ì¼ ë¦¬ìŠ¤íŠ¸ (ìë™ ì¶”ì¶œ + ìˆ˜ë™ ì¶”ê°€)</b></label>
            <textarea id="all-email-list" rows="4" class="form-control"></textarea>
            <div style="margin-top:6px;">
              <input type="email" id="manual-email-input" placeholder="ì´ë©”ì¼ ì¶”ê°€" class="form-control" style="width:60%;display:inline-block;">
              <button type="button" id="add-manual-email" class="btn btn-secondary" style="margin-left:6px;">+ ì¶”ê°€</button>
            </div>
          </div>
          <div class="form-group">
            <label><b>ì œëª©</b></label>
            <input type="text" id="all-email-subject" class="form-control">
          </div>
          <div class="form-group">
            <label><b>ë³¸ë¬¸</b></label>
            <textarea id="all-email-body" rows="6" class="form-control"></textarea>
          </div>
          <div style="margin-bottom:10px;">
            <button type="button" id="copy-all-email-list" class="btn btn-secondary">ì´ë©”ì¼ ë³µì‚¬</button>
            <button type="button" id="download-all-email-list" class="btn btn-secondary">TXTë¡œ ì €ì¥</button>
          </div>
        </div>
      </div>
    </div>
    <!-- ëœ¸í•œë¶„ë©”ì¼ ëª¨ë‹¬ -->
    <div id="modal-inactive-email" class="modal" style="display:none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ëœ¸í•œë¶„ ì´ë©”ì¼ ë°œì†¡</h2>
          <button type="button" class="close-btn" onclick="closeModal('modal-inactive-email')">&times;</button>
        </div>
        <div class="modal-body" id="modal-inactive-email-body">
          <div class="form-group">
            <label><b>ìµœê·¼ Xê°œì›” ì´ë‚´ ë‰´ìŠ¤ë ˆí„° ë¯¸ë“±ë¡</b></label>
            <input type="number" id="inactive-months" value="6" min="1" max="36" class="form-control" style="width:100px;display:inline-block;">
            <span style="margin-left:4px;">ê°œì›” ì „ê¹Œì§€</span>
            <button type="button" id="refresh-inactive-email-list" class="btn btn-secondary" style="margin-left:8px;">ë¦¬ìŠ¤íŠ¸ ê°±ì‹ </button>
          </div>
          <div class="form-group">
            <label><b>ì´ë©”ì¼ ë¦¬ìŠ¤íŠ¸ (ìë™ ì¶”ì¶œ + ìˆ˜ë™ ì¶”ê°€)</b></label>
            <textarea id="inactive-email-list" rows="4" class="form-control"></textarea>
            <div style="margin-top:6px;">
              <input type="email" id="manual-inactive-email-input" placeholder="ì´ë©”ì¼ ì¶”ê°€" class="form-control" style="width:60%;display:inline-block;">
              <button type="button" id="add-manual-inactive-email" class="btn btn-secondary" style="margin-left:6px;">+ ì¶”ê°€</button>
            </div>
          </div>
          <div class="form-group">
            <label><b>ì œëª©</b></label>
            <input type="text" id="inactive-email-subject" class="form-control">
          </div>
          <div class="form-group">
            <label><b>ë³¸ë¬¸</b></label>
            <textarea id="inactive-email-body" rows="6" class="form-control"></textarea>
          </div>
          <div style="margin-bottom:10px;">
            <button type="button" id="copy-inactive-email-list" class="btn btn-secondary">ì´ë©”ì¼ ë³µì‚¬</button>
            <button type="button" id="download-inactive-email-list" class="btn btn-secondary">TXTë¡œ ì €ì¥</button>
          </div>
        </div>
      </div>
    </div>
    <!-- í˜„ì§€ì •ë³´ì¶œë ¥ ëª¨ë‹¬ -->
    <div id="modal-export-local-info" class="modal" style="display:none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2>í˜„ì§€ ì •ë³´ ì—‘ì…€ ì¶œë ¥</h2>
          <button type="button" class="close-btn" onclick="closeModal('modal-export-local-info')">&times;</button>
        </div>
        <div class="modal-body" id="modal-export-local-info-body">
          <div class="form-group">
            <label><b>ì¶œë ¥í•  ì •ë³´ ì„ íƒ</b></label><br>
            <label style="margin-right:12px;"><input type="checkbox" class="export-field" value="englishName" checked> ì˜ë¬¸ì´ë¦„</label>
            <label style="margin-right:12px;"><input type="checkbox" class="export-field" value="localPhone" checked> í˜„ì§€ì „í™”</label>
            <label style="margin-right:12px;"><input type="checkbox" class="export-field" value="localAddress" checked> í˜„ì§€ì£¼ì†Œ</label>
            <button type="button" id="refresh-export-preview" class="btn btn-secondary" style="margin-left:8px;">ë¯¸ë¦¬ë³´ê¸° ê°±ì‹ </button>
          </div>
          <div style="margin-bottom:10px;max-height:180px;overflow:auto;">
            <table id="export-preview-table" style="width:100%;border-collapse:collapse;font-size:0.97em;">
              <thead><tr id="export-preview-head"></tr></thead>
              <tbody id="export-preview-body"></tbody>
            </table>
          </div>
          <div style="margin-bottom:10px;">
            <button type="button" id="download-export-excel" class="btn btn-primary">ì—‘ì…€ë¡œ ì €ì¥</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ì¦ëª…ì„œ ë°œê¸‰ ëª¨ë‹¬ -->
    <div id="modal-certificate" class="modal" style="display:none;">
      <div class="modal-content large-modal">
        <div class="modal-header">
          <h2 id="certificate-modal-title">ì¦ëª…ì„œ ë°œê¸‰</h2>
          <button type="button" class="close-btn" onclick="closeModal('modal-certificate')">&times;</button>
        </div>
        <div class="modal-body" id="modal-certificate-body">
          <div class="form-group">
            <label for="certificate-name-input"><b>ì´ë¦„ ì…ë ¥</b></label>
            <input type="text" id="certificate-name-input" class="form-control" placeholder="ì„ êµì‚¬ ì´ë¦„ ì…ë ¥" autocomplete="off">
            <div id="certificate-autocomplete" class="autocomplete-list"></div>
          </div>
          <div id="certificate-confirm-section" style="display:none;margin-bottom:12px;">
            <span id="certificate-confirm-text"></span>
            <button type="button" class="btn btn-primary" id="certificate-confirm-yes">ì˜ˆ</button>
            <button type="button" class="btn btn-secondary" id="certificate-confirm-no">ì•„ë‹ˆì˜¤</button>
          </div>
          <div id="certificate-preview-section" style="display:none;">
            <div style="margin-bottom:10px;"><b>ë¯¸ë¦¬ë³´ê¸°</b></div>
            <div id="certificate-preview-box" style="border:1.5px solid #d0d0e0;border-radius:8px;padding:18px 24px;background:#fff;min-height:180px;">
              <!-- ì„ì‹œ ì¦ëª…ì„œ í¼ ë‚´ìš© -->
              <div id="certificate-preview-content">ì¦ëª…ì„œ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ì…ë‹ˆë‹¤.</div>
            </div>
            <div style="margin-top:14px;">
              <button type="button" class="btn btn-primary" id="certificate-print-btn">ì¸ì‡„</button>
            </div>
          </div>
        </div>
      </div>
    </div>

         <!-- Firebase SDK (CDN) -->
     <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
     <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
     <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
     <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
     <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
     <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-functions.js"></script>

     <!-- Firebase Config -->
     <script src="js/firebase-config.js"></script>
     
     <!-- Common Navigation -->
     <script src="js/common/navigation.js"></script>

    <!-- Page Protection & Auth -->
    <script src="js/auth.js"></script>
    
    <!-- Page Scripts -->
    <script src="js/firebaseService.js"></script>
    <script src="js/missionaryManagement.js"></script>

    <!-- Nav Loader & Event Listeners -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('nav.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('nav-container').innerHTML = data;
                    
                    const logoutButton = document.getElementById('logout-button');
                    if(logoutButton) {
                        logoutButton.addEventListener('click', () => {
                            firebase.auth().signOut();
                        });
                    }

                    const userEmailSpan = document.getElementById('user-email');
                    firebase.auth().onAuthStateChanged(user => {
                        if(user && userEmailSpan) {
                            userEmailSpan.textContent = user.email;
                        }
                    });
                });

            const addBtn = document.getElementById('addMissionaryBtn');
            if(addBtn) {
                addBtn.onclick = () => window.location.href = 'missionary-input.html';
            }
        });
    </script>
</body>
</html> 