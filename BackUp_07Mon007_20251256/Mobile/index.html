<!DOCTYPE html>
<html lang="ko" class="sl-theme-light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>í•œêµ­ê¸°ë…êµì¥ë¡œíšŒ êµ­ì œí˜‘ë ¥ ì„ êµì‚¬ - ëª¨ë°”ì¼</title>
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
  
  <!-- Shoelace CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.12.0/cdn/themes/light.css" />
  
  <!-- Swiper CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  
  <!-- ëª¨ë°”ì¼ ì „ìš© CSS -->
  <link rel="stylesheet" href="css/header.css">
  <link rel="stylesheet" href="css/mobile.css">
  <link rel="stylesheet" href="css/mobile-detail.css">
  <link rel="stylesheet" href="css/greeting.css">
  <link rel="stylesheet" href="css/flipclock-custom.css">
  <link rel="stylesheet" href="css/presbytery-stats-luxury.css">
  <link rel="stylesheet" href="css/sending-stats.css">
  
  <!-- Shoelace JS -->
  <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.15.0/cdn/shoelace.js"></script>
  
  
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Pretendard:wght@400;600;700&display=swap" rel="stylesheet">
  
  <!-- ì„ êµí¸ì§€ ìŠ¤ì™€ì´í”„ ìŠ¤íƒ€ì¼ -->
  <style>
    /* ì„ êµí¸ì§€ ìŠ¤ì™€ì´í”„ ì„¹ì…˜ */
    .newsletter-swipe-section {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      z-index: 2500;
      display: flex;
      flex-direction: column;
      padding-bottom: 100px; /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë†’ì´ë§Œí¼ ì—¬ë°± */
    }
    
    /* ìƒë‹¨ ì  3ê°œ */
    .top-dots {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 1.2rem;
      font-weight: bold;
      z-index: 1000;
      animation: dotsPulse 2s ease-in-out infinite;
    }
    
    @keyframes dotsPulse {
      0%, 100% { opacity: 0.7; transform: translateX(-50%) scale(1); }
      50% { opacity: 1; transform: translateX(-50%) scale(1.05); }
    }
    
    /* íŒíŠ¸ í…ìŠ¤íŠ¸ */
    .hint-text {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .hint-dots {
      font-size: 1.2rem;
      font-weight: bold;
    }
    
    /* ë¡œë”© ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
    #loading-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
    }
    
    #loading-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
      pointer-events: none;
    }
    
    /* ë¡œë”© ìŠ¤í•€ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* ì„ êµí¸ì§€ ìŠ¤ì™€ì´í”„ ì»¨í…Œì´ë„ˆ */
    .news-swiper-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 2;
      padding-bottom: 100px; /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë†’ì´ë§Œí¼ ì—¬ë°± */
    }
    
    /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .news-card {
      background: white;
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      margin: 1rem;
      position: relative;
      min-height: 600px;
      width: 80vw !important;
      max-width: 400px;
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }
    
    /* ëª¨ë“  swiper-slide ë‚´ë¶€ì˜ news-cardì—ë„ ì ìš© */
    .swiper-slide .news-card {
      width: 80vw !important;
      margin: 0 10vw !important;
    }
    
    .news-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.15);
    }
    
    /* ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” ì˜ì—­ */
    .news-photo-swiper {
      width: 100%;
      height: 220px;
      margin-bottom: 1.5rem;
      border-radius: 16px;
      overflow: hidden;
      background: linear-gradient(135deg, #e0e7ef 0%, #f0f4f8 100%);
      position: relative;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }
    
    /* ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ */
    .news-photo-swiper .swiper-button-next,
    .news-photo-swiper .swiper-button-prev {
      display: flex !important;
      width: 40px;
      height: 40px;
      background: rgba(255,255,255,0.9);
      border-radius: 50%;
      color: #3f51b5;
      font-size: 16px;
      transition: all 0.3s ease;
    }
    
    .news-photo-swiper .swiper-button-next:hover,
    .news-photo-swiper .swiper-button-prev:hover {
      background: rgba(255,255,255,1);
      transform: scale(1.1);
    }
    
    .news-photo-swiper .swiper-button-next::after,
    .news-photo-swiper .swiper-button-prev::after {
      font-size: 16px;
      font-weight: bold;
    }
    
    /* ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” í˜ì´ì§• */
    .news-photo-swiper .swiper-pagination {
      display: flex !important;
      bottom: 10px;
    }
    
    .news-photo-swiper .swiper-pagination-bullet {
      background: rgba(255,255,255,0.6);
      opacity: 0.7;
      width: 8px;
      height: 8px;
    }
    
    .news-photo-swiper .swiper-pagination-bullet-active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      opacity: 1;
    }
    
    /* ê·¸ë¼ë°ì´ì…˜ ì´ë¯¸ì§€ë“¤ */
    .gradient-image-1 {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
      font-weight: 600;
    }
    
    .gradient-image-2 {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
      font-weight: 600;
    }
    
    .gradient-image-3 {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
      font-weight: 600;
    }
    
    /* ì´ë¦„ê³¼ íŒŒì†¡ë…„ë„ (ì™¼ìª½ ì •ë ¬) */
    .news-card-name-year {
      text-align: left;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .news-card-title { 
      font-size: 1.2rem; 
      font-weight: 700; 
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .news-card-sent-year {
      font-size: 0.9rem;
      color: #3f51b5;
      font-weight: 600;
    }
    
    /* êµ­ê°€ì™€ ì‚¬ì—­ë‚´ìš© (ì™¼ìª½ ì •ë ¬) */
    .news-card-location {
      text-align: left;
      font-size: 0.98rem;
      color: #3f51b5;
      margin-bottom: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    /* ê¸°ë„ì œëª© (ì™¼ìª½ ì •ë ¬) */
    .news-card-content {
      text-align: left;
      font-size: 1.05rem;
      color: #222;
      margin-bottom: 1.5rem;
      line-height: 1.6;
      max-height: 8em;
      overflow: hidden;
      text-overflow: ellipsis;
      flex-grow: 1;
    }
    
    /* ë‰´ìŠ¤ë ˆí„° ì›ë³¸ë³´ê¸° ë²„íŠ¼ ì»¨í…Œì´ë„ˆ (ê°€ìš´ë° ì •ë ¬) */
    .news-card-button-container {
      text-align: center;
      margin-bottom: 1rem;
    }
    
    /* ìµœê·¼ ë‰´ìŠ¤ë ˆí„° ë‚ ì§œ (ì˜¤ë¥¸ìª½ ì •ë ¬) */
    .news-card-date {
      text-align: right;
      font-size: 0.92rem;
      color: #aaa;
      margin-bottom: 0.5rem;
    }
    
    /* ë‰´ìŠ¤ë ˆí„° ì›ë³¸ë³´ê¸° ë²„íŠ¼ */
    .news-card-original-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 12px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .news-card-original-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }
    
    /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ */
    .mobile-bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 1rem;
      z-index: 3000;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
    }
    
    .mobile-bottom-nav-content {
      display: flex;
      justify-content: space-around;
      align-items: center;
      max-width: 500px;
      margin: 0 auto;
    }
    
    .nav-btn {
      background: none;
      border: none;
      color: rgba(255,255,255,0.8);
      font-size: 0.9rem;
      font-weight: 600;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.3rem;
    }
    
    .nav-btn.active {
      background: rgba(255,255,255,0.2);
      color: white;
    }
    
    .nav-btn:hover {
      background: rgba(255,255,255,0.1);
      color: white;
    }
    
    /* ë„¤ë¹„ê²Œì´ì…˜ ì•„ì´ì½˜ */
    .nav-btn::before {
      font-size: 1.2rem;
    }
    
    .nav-btn[data-nav="home"]::before { content: "ğŸ "; }
    .nav-btn[data-nav="news"]::before { content: "ğŸ“°"; }
    .nav-btn[data-nav="map"]::before { content: "ğŸ—ºï¸"; }
    .nav-btn[data-nav="search"]::before { content: "ğŸ”"; }
    .nav-btn[data-nav="profile"]::before { content: "ğŸ‘¤"; }
    
    /* Swiper í˜ì´ì§• ìŠ¤íƒ€ì¼ */
    .swiper-pagination-bullet {
      background: rgba(255,255,255,0.6);
      opacity: 0.7;
    }
    
    .swiper-pagination-bullet-active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      opacity: 1;
    }
  </style>
</head>
<body class="mobile-mode">
  <!-- ëª¨ë°”ì¼ ì²«í™”ë©´(ëœë”©) -->
  <div id="mobile-landing" class="mobile-landing logo-medium logo-normal">
    <!-- ìƒë‹¨ ë°” -->
    <div class="mobile-landing-topbar">
      <div class="mobile-landing-topbar-content">
        <img src="logo.svg" alt="ë¡œê³ " class="mobile-landing-logo">
        <div class="mobile-landing-title">í•œêµ­ê¸°ë…êµì¥ë¡œíšŒ êµ­ì œí˜‘ë ¥ ì„ êµì‚¬</div>
      </div>
    </div>
    
    <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
    <div class="mobile-landing-info">
      <div id="prayer-count-info" class="mobile-prayer-count-info"></div>
      <div class="mobile-landing-stats">
        <div class="stat-item" id="stat-item-clock">
          <div class="stat-label">í˜„ì¬ ì‹œê°„</div>
          <div class="stat-content">
            <div id="flip-clock-container"></div>
            <div class="greeting-display">
              <span id="greeting-text" class="greeting-text"></span>
            </div>
          </div>
        </div>
        <div class="stat-item clickable" id="stat-item-country" tabindex="0" role="button">
          <div class="stat-label">êµ­ê°€ë³„ íŒŒì†¡ í˜„í™©</div>
          <div class="stat-content" id="mobile-country-stats">ë°ì´í„° ë¡œë”© ì¤‘...</div>
        </div>
        <div class="stat-item clickable" id="stat-item-presbytery" tabindex="0" role="button">
          <div class="stat-label">ë…¸íšŒë³„ íŒŒì†¡ í˜„í™©</div>
          <div class="stat-content" id="mobile-presbytery-stats">ë°ì´í„° ë¡œë”© ì¤‘...</div>
        </div>
        <div class="stat-item clickable" id="stat-item-news" tabindex="0" role="button">
          <div class="stat-label">ì„ êµí¸ì§€ (ìµœê·¼ 3ê°œì›”)</div>
          <div class="stat-content" id="mobile-news-stats">
          í˜„ì¬ <b id="recent-news-count">0</b>ê°œì˜ ìƒˆë¡œìš´ ì†Œì‹ì´ ìˆìŠµë‹ˆë‹¤.
        </div>
      
        </div>
      </div>
    </div>
    
    
    <!-- ê¸°ì¡´ í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ì€ ì œê±°í•˜ê³  ìƒˆë¡œìš´ ë„¤ë¹„ê²Œì´ì…˜ìœ¼ë¡œ í†µí•© -->
    
    <!-- ë¡œê³  ì„¤ì • íŒ¨ë„ -->
    <div id="logo-settings-panel" class="logo-settings-panel">
      <div class="settings-content">
        <h3>ë°°ê²½ ë¡œê³  ì„¤ì •</h3>
        <div class="setting-group">
          <label>í¬ê¸°:</label>
          <div class="size-buttons">
            <button class="size-btn" data-size="small">ì‘ê²Œ</button>
            <button class="size-btn active" data-size="medium">ë³´í†µ</button>
            <button class="size-btn" data-size="large">í¬ê²Œ</button>
            <button class="size-btn" data-size="xlarge">ë§¤ìš° í¬ê²Œ</button>
          </div>
        </div>
        <div class="setting-group">
          <label>íˆ¬ëª…ë„:</label>
          <div class="opacity-buttons">
            <button class="opacity-btn" data-opacity="light">ì—°í•˜ê²Œ</button>
            <button class="opacity-btn active" data-opacity="normal">ë³´í†µ</button>
            <button class="opacity-btn" data-opacity="visible">ì§„í•˜ê²Œ</button>
          </div>
        </div>
        <button class="close-settings">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ê¸°ì¡´ ì§€ë„/ë³¸ë¬¸ ë“±ì€ ì²«í™”ë©´ ì§„ì… ì‹œ ìˆ¨ê¹€ ì²˜ë¦¬ -->
  <div id="main-app-content" style="display:none;">
    <!-- ëª¨ë°”ì¼ ë¡œë”© ì¸ë””ì¼€ì´í„° -->
    <div id="mobile-loading" class="mobile-loading">
      <div class="mobile-loading-spinner"></div>
    </div>

    <!-- ì§€ë„ ì»¨í…Œì´ë„ˆ -->
    <div id="map"></div>
    
    <!-- ëª¨ë°”ì¼ íƒ€ì´í‹€ë°” -->
    <div class="mobile-titlebar">
      <div class="mobile-titlebar-inner">
        <div class="mobile-titlebar-logo">
          <img src="logo.svg" alt="ë¡œê³ " style="height: 1.2em;">
        </div>
        <div class="mobile-titlebar-title">
          ì„ êµì‚¬ íŒŒì†¡ì§€ë„
        </div>
      </div>
    </div>
    
    <!-- ëª¨ë°”ì¼ ì„ êµì‚¬ ìŠ¤ì™€ì´í¼ -->
    <div id="mobile-missionary-swiper">
      <div class="swiper">
        <div class="swiper-wrapper">
          <!-- ì„ êµì‚¬ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
        <!-- Swiper ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="swiper-pagination"></div>
      </div>
      
      <!-- ë‹«ê¸° ë²„íŠ¼ -->
      <button class="close-mobile-swiper" id="close-mobile-swiper">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      
      <!-- í•˜ë‹¨ íŒíŠ¸ ì´ë¯¸ì§€ -->
      <div class="bottom-hint-image">
        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='none' stroke='rgba(255,255,255,0.3)' stroke-width='2'/%3E%3Cpath d='M30 50 L45 65 L70 35' stroke='rgba(255,255,255,0.6)' stroke-width='3' fill='none'/%3E%3C/svg%3E" alt="íŒíŠ¸">
      </div>
    </div>
    
    <!-- ì„ êµí¸ì§€ ìŠ¤ì™€ì´í”„ ì„¹ì…˜ -->
    <div id="newsletter-swipe-section" class="newsletter-swipe-section" style="display:none;">
      <!-- ìƒë‹¨ ì  3ê°œ -->
      <div class="top-dots" id="top-dots">
        <div class="hint-text">
          <span class="hint-dots">â€¢â€¢â€¢</span>
          <span>ì¢Œìš°ë¡œ ìŠ¤ì™€ì´í”„í•˜ì„¸ìš”</span>
        </div>
      </div>
      
      <!-- ë¡œë”© ìƒíƒœ í‘œì‹œ -->
      <div id="loading-container">
        <div style="text-align: center; position: relative; z-index: 1;">
          <div id="loadingStatus" style="margin-bottom: 1rem;">ì„ êµí¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
          <div style="width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid white; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
          <div id="loadingProgress" style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.8;"></div>
        </div>
      </div>
      
      <!-- ì„ êµí¸ì§€ ìŠ¤ì™€ì´í”„ ì»¨í…Œì´ë„ˆ -->
      <div class="news-swiper-container">
        <div class="swiper" id="swiper-container" style="display: none;">
          <div class="swiper-wrapper" id="news-swiper-wrapper">
            <!-- ì¹´ë“œê°€ JSë¡œ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
          </div>
          <div class="swiper-pagination"></div>
        </div>
      </div>
    </div>
    
    <!-- ëª¨ë°”ì¼ ê²€ìƒ‰ ì»¨í…Œì´ë„ˆ -->
    <div class="mobile-search-container" id="mobile-search-container">
      <div class="mobile-search-input-wrapper">
        <span class="mobile-search-icon">ğŸ”</span>
        <input type="text" id="mobile-missionary-search" placeholder="ì„ êµì‚¬ ì´ë¦„, êµ­ê°€, ê¸°ê´€ì„ ê²€ìƒ‰í•˜ì„¸ìš”..." autocomplete="off">
        <button type="button" class="mobile-search-clear" id="mobile-search-clear">âœ•</button>
      </div>
      <div id="mobile-search-results" class="mobile-search-results-dropdown"></div>
    </div>
    
    <!-- ëª¨ë°”ì¼ UI ì»¨íŠ¸ë¡¤ -->
    <div id="mobile-ui-controls">
      <sl-icon-button id="mobileSettingsBtn" name="gear-fill" label="ì„¤ì •" style="font-size: 1.2rem;"></sl-icon-button>
      <sl-icon-button id="mobileFullscreenBtn" name="fullscreen" label="ì „ì²´í™”ë©´" style="font-size: 1.2rem;"></sl-icon-button>
    </div>
    
    <!-- ëª¨ë°”ì¼ ìƒì„¸ë³´ê¸° íŒì—… -->
    <div id="mobile-detail-popup" class="mobile-detail-popup">
      <div class="mobile-detail-content">
        <!-- ìƒì„¸ ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
      </div>
      <button class="mobile-detail-close" id="mobile-detail-close">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <!-- ëª¨ë°”ì¼ í…Œì´ë¸” ì˜¤ë²„ë ˆì´ -->
    <div id="mobile-missionary-table-country" class="mobile-country-table-overlay"></div>
    <div id="mobile-missionary-table-presbytery" class="mobile-presbytery-table-overlay"></div>
    
    <!-- ëª¨ë°”ì¼ ì¢…ë£Œ ë²„íŠ¼ë“¤ -->
    <sl-button id="mobile-country-exit-btn" variant="danger" size="medium" pill class="mobile-exit-btn">
      <sl-icon slot="prefix" name="arrow-left"></sl-icon>
      êµ­ê°€ë³„ ë³´ê¸° ì¢…ë£Œ
    </sl-button>
    
    <sl-button id="mobile-presbytery-exit-btn" variant="danger" size="medium" pill class="mobile-exit-btn">
      <sl-icon slot="prefix" name="arrow-left"></sl-icon>
      ë…¸íšŒë³„ ë³´ê¸° ì¢…ë£Œ
    </sl-button>
    
    <!-- ëª¨ë°”ì¼ ê°€ì´ë“œ ë©”ì‹œì§€ -->
    <div id="mobile-map-guide" class="mobile-map-guide">
      ì´ ì§€ë„ëŠ” ì „ì„¸ê³„ì— í©ì–´ì ¸ ì„ êµì‚¬ì—­ì„ ê°ë‹¹í•˜ê³  ìˆëŠ” ì´íšŒíŒŒì†¡ í•´ì™¸ì„ êµë™ì—­ìë‹˜ë“¤ì˜ í˜„í™©ì„ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.<br>
      ê·€í•œ ì„ êµì‚¬ì—­ì„ ìœ„í•´ ê¸°ë„ë¡œ í•¨ê»˜ í•˜ì—¬ ì£¼ì‹œê¸°ë¥¼ ë¶€íƒë“œë¦½ë‹ˆë‹¤.
    </div>
    
    <!-- ëª¨ë°”ì¼ ë‰´ìŠ¤ë°” -->
    <div id="mobile-news-bar" class="mobile-news-bar">
      <div class="mobile-news-content">
        <span class="mobile-news-text">ìµœì‹  ì„ êµ ì†Œì‹ì„ í™•ì¸í•˜ì„¸ìš”</span>
      </div>
      <button class="mobile-news-close" id="mobile-news-close">âœ•</button>
    </div>
    
    <!-- ëª¨ë°”ì¼ ê¸°ë„ í™•ì¸ í† ìŠ¤íŠ¸ -->
    <div id="mobile-prayer-toast" class="mobile-prayer-toast">
      <div class="mobile-toast-content">
        <span class="mobile-toast-icon">ğŸ™</span>
        <div class="mobile-toast-text">
          <div class="mobile-toast-main">ê¸°ë„ê°€ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤</div>
          <div class="mobile-toast-sub">í•¨ê»˜ ê¸°ë„í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ (ì „ì—­) -->
  <div class="mobile-bottom-nav">
    <div class="mobile-bottom-nav-content">
      <button class="nav-btn" data-nav="home">í™ˆ</button>
      <button class="nav-btn" data-nav="news">ì„ êµí¸ì§€</button>
      <button class="nav-btn" data-nav="map">ì§€ë„</button>
      <button class="nav-btn" data-nav="search">ê²€ìƒ‰</button>
      <button class="nav-btn" data-nav="profile">ë‚´ì •ë³´</button>
    </div>
  </div>

  <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìŠ¤í¬ë¦½íŠ¸ -->
  <!-- <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script> -->
  <!-- <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  
  <!-- Firebase App (modular CDN) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    // ë°˜ë“œì‹œ ì£¼ìš” JS íŒŒì¼ë³´ë‹¤ ë¨¼ì €!
    const firebaseConfig = {
      apiKey: "AIzaSyCrJIhyTYQ4bTUW4jarFqluD97xKao2kF0",
      authDomain: "prokworldmap.firebaseapp.com",
      databaseURL: "https://prokworldmap-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "prokworldmap",
      storageBucket: "prokworldmap.appspot.com",
      messagingSenderId: "728381830842",
      appId: "1:728381830842:web:cfcb810657e1608d91f483",
      measurementId: "G-SVTPDV602Y"
    };
    if (window.firebase && window.firebase.initializeApp) {
      if (!window.firebase.apps.length) window.firebase.initializeApp(firebaseConfig);
    }
  </script>
  
  <!-- ê¸°ë³¸ ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="js/utils.js"></script>
  <script src="js/countryBackgrounds.js"></script>
  <script src="js/flipClock.js"></script>
  <script src="js/greetingManager.js"></script>
  <script src="js/ui/CountryStatsDetail.js"></script>
  <script src="js/ui/PresbyteryStatsDetail.js"></script>
  <!-- UI ì»´í¬ë„ŒíŠ¸ ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="js/ui/detailPopup.js"></script>
  <script src="js/ui/mobileDetailPopup.js"></script>
  <script src="js/ui/MobileMissionarySwiper.js"></script>
  <script src="js/newsletterPopup.js"></script>
  
  <!-- ì„ êµí¸ì§€ ìŠ¤ì™€ì´í”„ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    // ì„ êµí¸ì§€ ìŠ¤ì™€ì´í”„ ê´€ë ¨ ë³€ìˆ˜ë“¤
    let newsletterSwiper = null;
    let newsletterData = [];
    let currentBatch = 0;
    const BATCH_SIZE = 5;
    let isLoading = false;
    let allDataLoaded = false;
    
    // ë„¤ë¹„ê²Œì´ì…˜ ìƒíƒœ ê´€ë¦¬
    let currentSection = 'home';
    
    // DOM ìš”ì†Œë“¤
    const newsletterSection = document.getElementById('newsletter-swipe-section');
    const loadingContainer = document.getElementById('loading-container');
    const swiperContainer = document.getElementById('swiper-container');
    const newsSwiperWrapper = document.getElementById('news-swiper-wrapper');
    const loadingStatus = document.getElementById('loadingStatus');
    const loadingProgress = document.getElementById('loadingProgress');
    const topDots = document.getElementById('top-dots');
    
    // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ë“¤
    const navButtons = document.querySelectorAll('.nav-btn');
    
    // ë„¤ë¹„ê²Œì´ì…˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    navButtons.forEach(btn => {
      btn.addEventListener('click', function() {
        const navType = this.getAttribute('data-nav');
        handleNavigation(navType);
      });
    });
    
    // ë„¤ë¹„ê²Œì´ì…˜ ì²˜ë¦¬ í•¨ìˆ˜
    function handleNavigation(navType) {
      // ëª¨ë“  ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ë¹„í™œì„±í™”
      navButtons.forEach(btn => btn.classList.remove('active'));
      
      // í´ë¦­ëœ ë²„íŠ¼ í™œì„±í™”
      document.querySelector(`[data-nav="${navType}"]`).classList.add('active');
      
      switch(navType) {
        case 'home':
          showHomeSection();
          break;
        case 'news':
          showNewsletterSection();
          break;
        case 'map':
          showMapSection();
          break;
        case 'search':
          showSearchSection();
          break;
        case 'profile':
          showProfileSection();
          break;
      }
      
      currentSection = navType;
    }
    
    // í™ˆ ì„¹ì…˜ í‘œì‹œ
    function showHomeSection() {
      document.getElementById('mobile-landing').style.display = 'block';
      document.getElementById('main-app-content').style.display = 'none';
      newsletterSection.style.display = 'none';
    }
    
    // ì„ êµí¸ì§€ ì„¹ì…˜ í‘œì‹œ
    function showNewsletterSection() {
      document.getElementById('mobile-landing').style.display = 'none';
      document.getElementById('main-app-content').style.display = 'none';
      newsletterSection.style.display = 'flex';
      
      // ì„ êµí¸ì§€ ë°ì´í„°ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ë‹¤ë©´ ë¡œë“œ
      if (newsletterData.length === 0) {
        loadNewsletterData();
      }
    }
    
    // ì§€ë„ ì„¹ì…˜ í‘œì‹œ
    function showMapSection() {
      document.getElementById('mobile-landing').style.display = 'none';
      document.getElementById('main-app-content').style.display = 'block';
      newsletterSection.style.display = 'none';
    }
    
    // ê²€ìƒ‰ ì„¹ì…˜ í‘œì‹œ
    function showSearchSection() {
      document.getElementById('mobile-landing').style.display = 'none';
      document.getElementById('main-app-content').style.display = 'block';
      newsletterSection.style.display = 'none';
      // ê²€ìƒ‰ ê¸°ëŠ¥ í™œì„±í™”
      document.getElementById('mobile-search-container').style.display = 'block';
    }
    
    // ë‚´ì •ë³´ ì„¹ì…˜ í‘œì‹œ
    function showProfileSection() {
      document.getElementById('mobile-landing').style.display = 'none';
      document.getElementById('main-app-content').style.display = 'none';
      newsletterSection.style.display = 'none';
      // ë‚´ì •ë³´ ê¸°ëŠ¥ êµ¬í˜„
      alert('ë‚´ì •ë³´ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
    }
    
    // ì„ êµí¸ì§€ ë°ì´í„° ë¡œë“œ
    async function loadNewsletterData() {
      if (isLoading) return;
      
      isLoading = true;
      loadingContainer.style.display = 'flex';
      swiperContainer.style.display = 'none';
      
      try {
        // Firebase Realtime Databaseì—ì„œ ë°ì´í„° ë¡œë“œ
        const db = window.firebase.database();
        const snapshot = await db.ref('missionaryProfiles').once('value');
        const data = snapshot.val();
        
        if (data) {
          // ë°ì´í„°ë¥¼ ë°°ì—´ë¡œ ë³€í™˜í•˜ê³  ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬
          newsletterData = Object.values(data)
            .filter(item => item && item.name && item.country)
            .sort((a, b) => {
              const dateA = a.recentNewsletterDate ? new Date(a.recentNewsletterDate) : new Date(0);
              const dateB = b.recentNewsletterDate ? new Date(b.recentNewsletterDate) : new Date(0);
              return dateB - dateA; // ìµœì‹ ìˆœ
            });
          
          loadingStatus.textContent = `${newsletterData.length}ê°œì˜ ì„ êµí¸ì§€ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.`;
          
          // ì´ˆê¸° ë°°ì¹˜ ë¡œë“œ
          await loadNextBatch();
        } else {
          loadingStatus.textContent = 'ì„ êµí¸ì§€ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
        }
      } catch (error) {
        console.error('ì„ êµí¸ì§€ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        loadingStatus.textContent = 'ë°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
      } finally {
        isLoading = false;
      }
    }
    
    // ë‹¤ìŒ ë°°ì¹˜ ë¡œë“œ
    async function loadNextBatch() {
      if (isLoading || allDataLoaded) return;
      
      isLoading = true;
      const startIndex = currentBatch * BATCH_SIZE;
      const endIndex = startIndex + BATCH_SIZE;
      const batch = newsletterData.slice(startIndex, endIndex);
      
      if (batch.length === 0) {
        allDataLoaded = true;
        isLoading = false;
        return;
      }
      
      // ë¡œë”© ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
      const progress = Math.min(100, (endIndex / newsletterData.length) * 100);
      loadingProgress.textContent = `${endIndex}/${newsletterData.length} (${Math.round(progress)}%)`;
      
      // ë°°ì¹˜ ë°ì´í„°ë¡œ ì¹´ë“œ ìƒì„±
      batch.forEach(missionary => {
        createNewsletterCard(missionary);
      });
      
      currentBatch++;
      
      // ì²« ë²ˆì§¸ ë°°ì¹˜ë¼ë©´ Swiper ì´ˆê¸°í™”
      if (currentBatch === 1) {
        initializeSwiper();
      } else {
        // ê¸°ì¡´ Swiper ì—…ë°ì´íŠ¸
        if (newsletterSwiper) {
          newsletterSwiper.update();
        }
      }
      
      // ë¡œë”© ì™„ë£Œ ì²˜ë¦¬
      setTimeout(() => {
        loadingContainer.style.display = 'none';
        swiperContainer.style.display = 'block';
        isLoading = false;
        
        // ëª¨ë“  ë°ì´í„°ê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
        if (endIndex >= newsletterData.length) {
          allDataLoaded = true;
        }
      }, 500);
    }
    
    // ì„ êµí¸ì§€ ì¹´ë“œ ìƒì„±
    function createNewsletterCard(missionary) {
      const slide = document.createElement('div');
      slide.className = 'swiper-slide';
      
      // ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” HTML
      const photoSliderHTML = `
        <div class="swiper news-photo-swiper">
          <div class="swiper-wrapper">
            <div class="swiper-slide">
              <div class="gradient-image-1">ì„ êµì‚¬ì—­</div>
            </div>
            <div class="swiper-slide">
              <div class="gradient-image-2">ê¸°ë„ì œëª©</div>
            </div>
            <div class="swiper-slide">
              <div class="gradient-image-3">ì†Œì‹</div>
            </div>
          </div>
          <div class="swiper-button-next"></div>
          <div class="swiper-button-prev"></div>
          <div class="swiper-pagination"></div>
        </div>
      `;
      
      // ì¹´ë“œ HTML
      slide.innerHTML = `
        <div class="news-card">
          ${photoSliderHTML}
          
          <div class="news-card-name-year">
            <div class="news-card-title">${missionary.name || 'ì´ë¦„ ì—†ìŒ'}</div>
            <div class="news-card-sent-year">${missionary.sentYear || 'íŒŒì†¡ë…„ë„ ë¯¸ìƒ'}</div>
          </div>
          
          <div class="news-card-location">
            <span>ğŸŒ</span>
            <span>${missionary.country || 'êµ­ê°€ ë¯¸ìƒ'}</span>
            <span>â€¢</span>
            <span>${missionary.ministry || 'ì‚¬ì—­ë‚´ìš© ë¯¸ìƒ'}</span>
          </div>
          
          <div class="news-card-content">
            ${missionary.prayerRequest || 'ê¸°ë„ì œëª©ì´ ì—†ìŠµë‹ˆë‹¤.'}
          </div>
          
          <div class="news-card-button-container">
            <button class="news-card-original-btn" onclick="openNewsletter('${missionary.name || ''}')">
              ë‰´ìŠ¤ë ˆí„° ì›ë³¸ë³´ê¸°
            </button>
          </div>
          
          <div class="news-card-date">
            ${missionary.recentNewsletterDate ? `ìµœê·¼ ë‰´ìŠ¤ë ˆí„°: ${formatDate(missionary.recentNewsletterDate)}` : 'ë‰´ìŠ¤ë ˆí„° ë‚ ì§œ ì—†ìŒ'}
          </div>
        </div>
      `;
      
      newsSwiperWrapper.appendChild(slide);
      
      // ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” ì´ˆê¸°í™”
      const photoSwiper = new Swiper(slide.querySelector('.news-photo-swiper'), {
        loop: true,
        autoplay: {
          delay: 3000,
          disableOnInteraction: false,
        },
        pagination: {
          el: slide.querySelector('.news-photo-swiper .swiper-pagination'),
          clickable: true,
        },
        navigation: {
          nextEl: slide.querySelector('.news-photo-swiper .swiper-button-next'),
          prevEl: slide.querySelector('.news-photo-swiper .swiper-button-prev'),
        },
      });
    }
    
    // Swiper ì´ˆê¸°í™”
    function initializeSwiper() {
      newsletterSwiper = new Swiper('#swiper-container', {
        slidesPerView: 1,
        spaceBetween: 20,
        centeredSlides: true,
        loop: false,
        autoplay: false,
        pagination: {
          el: '.swiper-pagination',
          clickable: true,
        },
        on: {
          slideChange: function() {
            // ë§ˆì§€ë§‰ ìŠ¬ë¼ì´ë“œì— ê°€ê¹Œì›Œì§€ë©´ ë‹¤ìŒ ë°°ì¹˜ ë¡œë“œ
            const currentIndex = this.activeIndex;
            const totalSlides = this.slides.length;
            
            if (totalSlides - currentIndex <= 2 && !allDataLoaded) {
              loadNextBatch();
            }
          }
        }
      });
    }
    
    // ë‚ ì§œ í¬ë§·íŒ…
    function formatDate(dateString) {
      try {
        const date = new Date(dateString);
        return date.toLocaleDateString('ko-KR', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
      } catch (error) {
        return dateString;
      }
    }
    
    // ë‰´ìŠ¤ë ˆí„° ì›ë³¸ë³´ê¸° í•¨ìˆ˜
    function openNewsletter(missionaryName) {
      alert(`${missionaryName} ì„ êµì‚¬ì˜ ë‰´ìŠ¤ë ˆí„° ì›ë³¸ë³´ê¸° ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.`);
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì •
    document.addEventListener('DOMContentLoaded', function() {
      // í™ˆ ë²„íŠ¼ì„ ê¸°ë³¸ í™œì„±í™”
      document.querySelector('[data-nav="home"]').classList.add('active');
    });
  </script>
  <!-- ëª¨ë°”ì¼ ì „ìš© ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // ë‚ ì§œ í‘œì‹œ ê¸°ëŠ¥ ë‹¤ì‹œ ì¶”ê°€
      function updateDate() {
        const dateElement = document.querySelector('.date-main');
        if (!dateElement) return;
        
        const now = new Date();
        const yyyy = now.getFullYear();
        const mm = String(now.getMonth() + 1).padStart(2, '0');
        const dd = String(now.getDate()).padStart(2, '0');
        
        dateElement.textContent = `${yyyy}.${mm}.${dd}`;
      }
      
      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¦‰ì‹œ ì‹¤í–‰í•˜ê³ , ë‚ ì´ ë°”ë€” ìˆ˜ ìˆìœ¼ë‹ˆ 1ë¶„ë§ˆë‹¤ ì²´í¬
      updateDate();
      setInterval(updateDate, 60000);

      // ì¤‘ë³´ê¸°ë„ì ìˆ˜ - prok-pagesì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ìˆ˜ì •
      const prayerCountDiv = document.getElementById('prayer-count-info');
      if (prayerCountDiv && window.firebase && window.firebase.database) {
        const db = window.firebase.database();
        
        // ì‚¬ìš©ì í‚¤ ìƒì„±
        const userKey = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        console.log('Missionary-app: ì‚¬ìš©ì í‚¤ ìƒì„±:', userKey);
        
        // í˜„ì¬ ì‚¬ìš©ìë¥¼ prayerUsersì— ë“±ë¡
        db.ref('prayerUsers').child(userKey).set({
          timestamp: Date.now(),
          userAgent: navigator.userAgent,
          page: window.location.pathname
        }).then(() => {
          console.log('Missionary-app: ì‚¬ìš©ì ë“±ë¡ ì™„ë£Œ');
        }).catch((error) => {
          console.error('Missionary-app: ì‚¬ìš©ì ë“±ë¡ ì‹¤íŒ¨:', error);
        });
        
        // ì‹¤ì‹œê°„ ì¤‘ë³´ê¸°ë„ì ìˆ˜ ê°ì‹œ
        db.ref('prayerUsers').on('value', (snapshot) => {
          const count = snapshot.numChildren();
          console.log('Missionary-app: ì¤‘ë³´ê¸°ë„ì ìˆ˜ ì—…ë°ì´íŠ¸:', count, 'ëª…');
          prayerCountDiv.textContent = `í˜„ì¬ ${count}ëª…ì˜ ì¤‘ë³´ê¸°ë„ìê°€ í•¨ê»˜ ê¸°ë„í•˜ê³  ìˆìŠµë‹ˆë‹¤`;
        });
        
        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì‚¬ìš©ì ì œê±°
        window.addEventListener('beforeunload', () => {
          db.ref('prayerUsers').child(userKey).remove();
          console.log('Missionary-app: ì‚¬ìš©ì ì œê±°ë¨');
        });
        
        // ì£¼ê¸°ì ìœ¼ë¡œ ì‚¬ìš©ì ìƒíƒœ ê°±ì‹  (ì—°ê²° ìœ ì§€)
        setInterval(() => {
          db.ref('prayerUsers').child(userKey).update({
            timestamp: Date.now()
          });
        }, 30000); // 30ì´ˆë§ˆë‹¤
      }
      
      // ì„ êµì‚¬ ë°ì´í„°
      window.fetchData((err, data) => {
        if (err) {
          alert('ë°ì´í„° ë¡œë”© ì‹¤íŒ¨: ' + err.message);
          return;
        }
        const missionaries = data.missionaries || [];
        // êµ­ê°€ë³„ í†µê³„
        const countrySet = new Set();
        const countryStats = {};
        missionaries.forEach(m => {
          if (m.country) {
            countrySet.add(m.country);
            countryStats[m.country] = (countryStats[m.country] || 0) + 1;
          }
        });
        window.cachedCountryStats = countryStats; // ì „ì—­ì— ì €ì¥
        const countryDiv = document.getElementById('mobile-country-stats');
        if (countryDiv) {
          countryDiv.innerHTML = `<b>${countrySet.size}</b>ê°œì˜ êµ­ê°€ì—ì„œ <b>${missionaries.length}</b>ëª…ì˜ ì„ êµì‚¬ê°€ ì‚¬ì—­í•˜ê³  ìˆìŠµë‹ˆë‹¤.`;
          countryDiv.addEventListener('click', function() {
            if (window.showCountryStatsDetail) window.showCountryStatsDetail();
          });
          countryDiv.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              if (window.showCountryStatsDetail) window.showCountryStatsDetail();
            }
          });
        }
        // ë…¸íšŒë³„ í†µê³„
        const presbyterySet = new Set();
        const presbyteryStats = {};
        missionaries.forEach(m => {
          if (m.presbytery) {
            presbyterySet.add(m.presbytery);
            presbyteryStats[m.presbytery] = (presbyteryStats[m.presbytery] || 0) + 1;
          }
        });
        window.cachedPresbyteryStats = presbyteryStats; // ì „ì—­ì— ì €ì¥
        const presbyteryDiv = document.getElementById('mobile-presbytery-stats');
        if (presbyteryDiv) {
          presbyteryDiv.innerHTML = `<b>${presbyterySet.size}</b>ê°œì˜ ë…¸íšŒì—ì„œ <b>${missionaries.length}</b>ëª…ì˜ ì„ êµì‚¬ë¥¼ íŒŒì†¡í•˜ì˜€ìŠµë‹ˆë‹¤.`;
          presbyteryDiv.addEventListener('click', function() {
            if (window.showPresbyteryStatsDetail) window.showPresbyteryStatsDetail();
          });
          presbyteryDiv.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              if (window.showPresbyteryStatsDetail) window.showPresbyteryStatsDetail();
            }
          });
        }
        // ì„ êµì‚¬ ì „ì²´ë„ ìºì‹œ
        window.cachedMissionaries = missionaries;
      });
      // êµ­ê°€ë³„/ë…¸íšŒë³„ í†µê³„ ë°•ìŠ¤ í´ë¦­ ì‹œ ìƒì„¸í™”ë©´ ì—°ê²°
      const statCountry = document.getElementById('stat-item-country');
      if (statCountry) {
        statCountry.addEventListener('click', function() {
          if (window.showCountryStatsDetail) window.showCountryStatsDetail();
        });
        statCountry.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            if (window.showCountryStatsDetail) window.showCountryStatsDetail();
          }
        });
      }
      const statPresbytery = document.getElementById('stat-item-presbytery');
      if (statPresbytery) {
        statPresbytery.addEventListener('click', function() {
          if (window.showPresbyteryStatsDetail) window.showPresbyteryStatsDetail();
        });
        statPresbytery.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            if (window.showPresbyteryStatsDetail) window.showPresbyteryStatsDetail();
          }
        });
      }
    });

    // ìµœê·¼ 3ê°œì›” ë‰´ìŠ¤/í¸ì§€ ê°œìˆ˜ ê³„ì‚° (ì‹¤ì œ ë°ì´í„° ì—°ë™)
    document.addEventListener('DOMContentLoaded', function() {
      function countRecentNews(newsArray) {
        const now = new Date();
        const threeMonthsAgo = new Date(now.getFullYear(), now.getMonth() - 3, now.getDate());
        return newsArray.filter(item => {
          if (!item.lastUpdate) return false;
          const date = new Date(item.lastUpdate);
          return date >= threeMonthsAgo;
        }).length;
      }
      // ì‹¤ì œ ë°ì´í„°: window.cachedNewsë§Œ ì‚¬ìš© (DataManager ì°¸ì¡° ì œê±°)
      var newsArray = window.cachedNews || [];
      var countElem = document.getElementById('recent-news-count');
      if (countElem) countElem.textContent = countRecentNews(newsArray);
    });

    // ìµœê·¼ 3ê°œì›” missionaries lastUpdate ê¸°ì¤€ ì†Œì‹ ê°œìˆ˜ ê³„ì‚° (stat-item-presbytery ì•„ë˜ recent-news-countì— ì ìš©)
    // DataManager ì˜ì¡´ ì½”ë“œ ì œê±°
  </script>
  <div id="country-stats-screen" class="glass-screen sending-glass-screen" style="display:none"></div>
  <div id="presbytery-stats-screen" class="glass-screen sending-glass-screen" style="display:none"></div>

  <script>
    // í”Œë¦½ ì‹œê³„ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
      const flipClockContainer = document.getElementById('flip-clock-container');
      if (flipClockContainer) {
        new FlipClock(flipClockContainer);
      }
      
      // ì¸ì‚¬ë§ ë§¤ë‹ˆì € ì´ˆê¸°í™”
      if (window.GreetingManager) {
        new GreetingManager();
      }
      
      // ë¡œê³  ì„¤ì • íŒ¨ë„ ê¸°ëŠ¥
      const settingsBtn = document.getElementById('logo-settings-btn');
      const settingsPanel = document.getElementById('logo-settings-panel');
      const closeBtn = document.querySelector('.close-settings');
      const mobileLanding = document.getElementById('mobile-landing');
      
      // ì„¤ì • íŒ¨ë„ ì—´ê¸°
      if (settingsBtn) {
        settingsBtn.addEventListener('click', function() {
          settingsPanel.classList.add('show');
        });
      }
      
      // ì„¤ì • íŒ¨ë„ ë‹«ê¸°
      if (closeBtn) {
        closeBtn.addEventListener('click', function() {
          settingsPanel.classList.remove('show');
        });
      }
      
      // ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
      if (settingsPanel) {
        settingsPanel.addEventListener('click', function(e) {
          if (e.target === settingsPanel) {
            settingsPanel.classList.remove('show');
          }
        });
      }
      
      // í¬ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
      document.querySelectorAll('.size-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          // í™œì„± ìƒíƒœ ë³€ê²½
          document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          
          // ë¡œê³  í¬ê¸° í´ë˜ìŠ¤ ë³€ê²½
          const size = this.dataset.size;
          mobileLanding.classList.remove('logo-small', 'logo-medium', 'logo-large', 'logo-xlarge');
          mobileLanding.classList.add('logo-' + size);
        });
      });
      
      // íˆ¬ëª…ë„ ë²„íŠ¼ ì´ë²¤íŠ¸
      document.querySelectorAll('.opacity-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          // í™œì„± ìƒíƒœ ë³€ê²½
          document.querySelectorAll('.opacity-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          
          // ë¡œê³  íˆ¬ëª…ë„ í´ë˜ìŠ¤ ë³€ê²½
          const opacity = this.dataset.opacity;
          mobileLanding.classList.remove('logo-light', 'logo-normal', 'logo-visible');
          mobileLanding.classList.add('logo-' + opacity);
        });
      });
    });
  </script>
  <script src="js/ui/SendingStats.js"></script>
</body>
</html> 